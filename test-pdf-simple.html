<!DOCTYPE html>
<html>
<head>
    <title>Test PDF Generation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div id="receipt-content" style="width: 800px; padding: 20px; background: white; color: black;">
        <h1>BoxCric Booking Receipt</h1>
        <p>Booking ID: BCMEHZWHB9XC0IG</p>
        <p>Ground: Test Ground</p>
        <p>Date: Tuesday 19 August, 2025</p>
        <p>Time: 06:00 pm - 09:00 pm</p>
        <p>Duration: 3 hours</p>
        <p>Status: CONFIRMED</p>
    </div>

    <button onclick="generatePDF()">Generate PDF</button>

    <script>
        async function generatePDF() {
            console.log('Starting PDF generation...');
            
            const element = document.getElementById('receipt-content');
            console.log('Element:', element);
            console.log('Element content:', element.innerHTML);
            
            try {
                // Generate canvas
                const canvas = await html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: true,
                    useCORS: true,
                    allowTaint: true
                });
                
                console.log('Canvas generated:', canvas.width, 'x', canvas.height);
                
                // Check canvas content
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                let hasContent = false;
                
                for (let i = 0; i < data.length; i += 4) {
                    if (data[i] !== 255 || data[i + 1] !== 255 || data[i + 2] !== 255) {
                        hasContent = true;
                        break;
                    }
                }
                
                console.log('Canvas has content:', hasContent);
                
                if (!hasContent) {
                    alert('Canvas is blank!');
                    return;
                }
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save('test-receipt.pdf');
                
                console.log('PDF saved successfully!');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
