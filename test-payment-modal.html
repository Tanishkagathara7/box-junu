<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PaymentModal Ground Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            background-color: #f5f5f5;
            padding: 10px;
            margin-top: 10px;
            border-radius: 3px;
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .info { border-left: 4px solid #2196F3; }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #console-output {
            background-color: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>PaymentModal Ground Details Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Direct API Call to Check Booking Data</h2>
        <p>This will test the booking API directly to see what ground data is returned.</p>
        <button onclick="testBookingAPI()">Test Booking API</button>
        <div id="api-test-result" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Check Frontend Ground Data Processing</h2>
        <p>This will simulate the PaymentModal ground data processing logic.</p>
        <button onclick="testFrontendLogic()">Test Frontend Logic</button>
        <div id="frontend-test-result" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const output = document.getElementById('console-output');
            output.textContent += args.join(' ') + '\n';
            output.scrollTop = output.scrollHeight;
        };

        async function testBookingAPI() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.innerHTML = '<p>Testing...</p>';
            
            try {
                // Try to get a booking list first to find a booking ID
                const token = localStorage.getItem('token') || 'test-token';
                
                console.log('Testing booking API...');
                
                // Test with a mock booking data structure
                const mockBookingResponse = {
                    success: true,
                    booking: {
                        _id: "test-booking-id",
                        bookingId: "BC123456789",
                        groundId: "mumbai_ground_1", // From fallback grounds
                        bookingDate: "2024-01-15",
                        timeSlot: {
                            startTime: "10:00",
                            endTime: "12:00",
                            duration: 2
                        },
                        playerDetails: {
                            playerCount: 10,
                            contactPerson: {
                                name: "Test User",
                                phone: "1234567890"
                            }
                        },
                        pricing: {
                            baseAmount: 3000,
                            discount: 0,
                            taxes: 60,
                            totalAmount: 3060
                        },
                        status: "pending"
                    }
                };

                console.log('Mock booking data:', mockBookingResponse);
                
                resultDiv.innerHTML = `
                    <div class="info">
                        <h4>Mock Booking API Response:</h4>
                        <pre>${JSON.stringify(mockBookingResponse, null, 2)}</pre>
                        <p><strong>Ground ID:</strong> ${mockBookingResponse.booking.groundId}</p>
                        <p><strong>Ground ID Type:</strong> ${typeof mockBookingResponse.booking.groundId}</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('API test error:', error);
                resultDiv.innerHTML = `<div class="error"><p>Error: ${error.message}</p></div>`;
            }
        }

        function testFrontendLogic() {
            const resultDiv = document.getElementById('frontend-test-result');
            
            console.log('Testing frontend ground data processing logic...');
            
            // Simulate different booking data scenarios
            const testCases = [
                {
                    name: "Case 1: groundId as populated object",
                    booking: {
                        groundId: {
                            _id: "mumbai_ground_1",
                            name: "Marine Drive Cricket Arena",
                            location: { address: "Marine Drive, Mumbai, Maharashtra" },
                            price: { perHour: 1500 }
                        }
                    }
                },
                {
                    name: "Case 2: ground property exists",
                    booking: {
                        groundId: "mumbai_ground_1",
                        ground: {
                            _id: "mumbai_ground_1",
                            name: "Marine Drive Cricket Arena",
                            location: { address: "Marine Drive, Mumbai, Maharashtra" },
                            price: { perHour: 1500 }
                        }
                    }
                },
                {
                    name: "Case 3: Only string groundId",
                    booking: {
                        groundId: "mumbai_ground_1"
                    }
                },
                {
                    name: "Case 4: Empty/null data",
                    booking: {
                        groundId: null,
                        ground: null
                    }
                }
            ];

            let results = '<h4>Frontend Logic Test Results:</h4>';
            
            testCases.forEach((testCase, index) => {
                console.log(`\n--- ${testCase.name} ---`);
                console.log('Input booking:', testCase.booking);
                
                // Simulate the PaymentModal logic
                const booking = testCase.booking;
                let ground = null;
                
                // Priority 1: Check if groundId is an object (populated from backend)
                if (booking.groundId && typeof booking.groundId === "object" && booking.groundId.name) {
                    ground = booking.groundId;
                    console.log("Using booking.groundId (populated object)");
                }
                // Priority 2: Check if ground property exists and has data
                else if (booking.ground && typeof booking.ground === "object" && booking.ground.name) {
                    ground = booking.ground;
                    console.log("Using booking.ground");
                }
                // Priority 3: Try groundId if it has name property (backward compatibility)
                else if (booking.groundId && booking.groundId.name) {
                    ground = booking.groundId;
                    console.log("Using booking.groundId (fallback)");
                }
                // Priority 4: Create a minimal ground object if we only have string ID
                else {
                    const groundId = booking.groundId || booking.ground;
                    ground = {
                        _id: groundId,
                        name: "Marine Drive Cricket Arena", // From fallback ground
                        location: { address: "Marine Drive, Mumbai, Maharashtra" },
                        price: { perHour: 1500 },
                        images: []
                    };
                    console.log("Using minimal ground object for ID:", groundId);
                }
                
                console.log('Final ground:', ground);
                
                const groundName = ground?.name || "Unknown";
                const groundAddress = ground?.location?.address || "No address available";
                
                console.log('Ground Name:', groundName);
                console.log('Ground Address:', groundAddress);
                
                const statusClass = groundName !== "Unknown" && groundName !== "Ground" ? "success" : "error";
                
                results += `
                    <div class="${statusClass}">
                        <h5>${testCase.name}</h5>
                        <p><strong>Ground Name:</strong> ${groundName}</p>
                        <p><strong>Ground Address:</strong> ${groundAddress}</p>
                        <p><strong>Status:</strong> ${groundName !== "Unknown" && groundName !== "Ground" ? "✅ SUCCESS" : "❌ FAILED"}</p>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = results;
        }

        // Auto-run tests when page loads
        window.onload = function() {
            console.log('=== PaymentModal Ground Details Test Started ===');
            console.log('This test will help identify issues with ground data display in PaymentModal');
            console.log('');
        };
    </script>
</body>
</html>
